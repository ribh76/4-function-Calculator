<!DOCTYPE html>
let w = (r===4 && c===0) ? bw*2 + gap : bw; // 0 is double width
let x = x0 + c*(bw+gap);
let y = y0 + r*(bh+gap);
if (r===4 && c>0) x += bw + gap; // shift after double 0
buttons.push(new Button(x,y,w,bh,label,isOp(label)));
}
}
}


class Button{
constructor(x,y,w,h,label,op){ this.x=x; this.y=y; this.w=w; this.h=h; this.label=label; this.op=op; }
draw(){
noStroke(); fill(this.op? color(255,149,0): color(40)); rect(this.x,this.y,this.w,this.h,14);
fill(245); textAlign(CENTER, CENTER); textSize(22); text(this.label, this.x+this.w/2, this.y+this.h/2);
}
hit(mx,my){ return mx>=this.x && mx<=this.x+this.w && my>=this.y && my<=this.y+this.h; }
}


function mousePressed(){
for (const b of buttons){ if (b.hit(mouseX, mouseY)){ press(b.label); break; } }
}


function keyPressed(){
// Enter and Backspace are special in p5
if (keyCode === ENTER || key === '=') { equals(); return; }
if (key === 'C' || key === 'c') { allClear(); return; }
if (key === "+" || key === "-" || key === "*" || key === "/"){
const mapOp = (key === '*')? '×' : (key === '/')? '÷' : key;
queueBinary(mapOp); return;
}
if (key === '.' ) { inputDot(); return; }
if (key === '%') { percent(); return; }
}


function keyTyped(){
if (key>='0' && key<='9') inputDigit(key);
}


function press(label){
switch(label){
case "0": case "1": case "2": case "3": case "4":
case "5": case "6": case "7": case "8": case "9": inputDigit(label); break;
case ".": inputDot(); break;
case "+": case "-": case "×": case "÷": queueBinary(label); break;
case "=": equals(); break;
case "C": allClear(); break;
case "±": toggleSign(); break;
case "%": percent(); break;
case "←": backspace(); break;
}
}
</script>
</body>
</html>
